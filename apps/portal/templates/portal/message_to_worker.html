{% extends "portal/base_portal.html" %}
{% load i18n %}
{% load portal_tags %}

{% block title %}{% blocktrans with worker_term=term.worker %}Message My {{ worker_term }}{% endblocktrans %}{% endblock %}

{% block content %}
<h1>{% blocktrans with worker_term=term.worker %}Message My {{ worker_term }}{% endblocktrans %}</h1>

<div class="portal-notice" role="note">
    <p>{% blocktrans with worker_term=term.worker %}Your {{ worker_term }} will see this next time they check. This is not for emergencies.{% endblocktrans %}</p>
</div>

{% if success %}
<p role="status" class="portal-alert portal-alert-success">{% blocktrans with worker_term=term.worker %}Your message has been sent. Your {{ worker_term }} will see it next time they check.{% endblocktrans %}</p>
{% endif %}

<form method="post" action="{% url 'portal:message_to_worker' %}">
    {% csrf_token %}

    <label for="message">{% trans "Your message" %}</label>
    <textarea id="message" name="message" rows="6" required
              aria-describedby="message-help"
              placeholder="{% trans 'Write your message here...' %}">{% if form.message.value %}{{ form.message.value }}{% endif %}</textarea>
    <small id="message-help">{% blocktrans with worker_term=term.worker %}Write whatever is on your mind. Your {{ worker_term }} will read this.{% endblocktrans %}</small>

    {% if form.message.errors %}
    <p role="alert" class="portal-alert portal-alert-error">{{ form.message.errors.0 }}</p>
    {% endif %}

    <button type="submit">{% trans "Send message" %}</button>
</form>

{% if recent_messages %}
<hr>
<section aria-labelledby="sent-messages-heading">
    <h2 id="sent-messages-heading">{% trans "Your recent messages" %}</h2>
    {% for msg in recent_messages %}
    <article class="portal-sent-message">
        <time datetime="{{ msg.created_at|date:'Y-m-d' }}">{{ msg.created_at|portal_date }}</time>
        <p>{{ msg.content }}</p>
        {% if msg.archived_at %}
        <small class="portal-msg-read">&#10003; {% trans "Read" %}</small>
        {% endif %}
    </article>
    {% endfor %}
</section>
{% endif %}

<hr>

<details class="portal-crisis-resources" role="complementary" aria-label="{% trans 'Crisis resources' %}">
    <summary>{% trans "If you need help right now" %}</summary>
    <ul>
        <li>
            <strong>{% trans "Emergency:" %}</strong> {% trans "Call" %} <a href="tel:911">911</a>
        </li>
        <li>
            <strong>{% trans "Talk Suicide Canada:" %}</strong>
            <a href="tel:1-833-456-4566">1-833-456-4566</a>
            — {% trans "24 hours a day, 7 days a week" %}
        </li>
        <li>
            <strong>{% trans "211 Ontario:" %}</strong>
            <a href="tel:211">211</a>
            — {% trans "Community and social services information" %}
        </li>
    </ul>
</details>
{% endblock %}
