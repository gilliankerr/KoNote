{% load i18n %}
{% if page.object_list %}
<figure>
<table role="grid" class="client-table" aria-label="{% blocktrans with clients=term.client_plural|default:'Participants' %}{{ clients }} list{% endblocktrans %}">
    <thead>
        <tr>
            <th scope="col">
                {% if sort_by == "name" or not sort_by %}
                    <strong>{% trans "Name" %}</strong>
                {% else %}
                    <a href="?sort=name{% if status_filter %}&status={{ status_filter }}{% endif %}{% if program_filter %}&program={{ program_filter }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}"
                       hx-get="{% url 'clients:client_list' %}?sort=name{% if status_filter %}&status={{ status_filter }}{% endif %}{% if program_filter %}&program={{ program_filter }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}"
                       hx-target="#client-list-container"
                       hx-indicator="#loading-bar"
                       hx-push-url="true">{% trans "Name" %}</a>
                {% endif %}
            </th>
            <th scope="col">{% trans "Record ID" %}</th>
            <th scope="col">{% trans "Status" %}</th>
            <th scope="col">{{ term.program_plural|default:"Programs" }}</th>
            <th scope="col">
                {% if sort_by == "last_contact" %}
                    <strong>{% trans "Last Contact" %}</strong>
                {% else %}
                    <a href="?sort=last_contact{% if status_filter %}&status={{ status_filter }}{% endif %}{% if program_filter %}&program={{ program_filter }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}"
                       hx-get="{% url 'clients:client_list' %}?sort=last_contact{% if status_filter %}&status={{ status_filter }}{% endif %}{% if program_filter %}&program={{ program_filter }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}"
                       hx-target="#client-list-container"
                       hx-indicator="#loading-bar"
                       hx-push-url="true">{% trans "Last Contact" %}</a>
                {% endif %}
            </th>
        </tr>
    </thead>
    <tbody>
        {% for item in page %}
        <tr>
            <td><a href="{% url 'clients:client_detail' client_id=item.client.pk %}">{{ item.name }}</a></td>
            <td data-label="{% trans 'ID' %}">{{ item.client.record_id|default:"â€”" }}</td>
            <td data-label="{% trans 'Status' %}">
                {% if item.client.status == "active" %}
                    <span class="badge badge-success">{% trans "Active" %}</span>
                {% elif item.client.status == "inactive" %}
                    <span class="badge badge-warning">{% trans "Inactive" %}</span>
                {% else %}
                    <span class="badge badge-neutral">{% trans "Discharged" %}</span>
                {% endif %}
            </td>
            <td data-label="{{ term.program_plural|default:'Programs' }}">
                {% for prog in item.programs %}
                <span class="program-dot" style="background-color: {{ prog.colour_hex }}" aria-hidden="true"></span>{{ prog.translated_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </td>
            <td data-label="{% trans 'Last Contact' %}">
                {% if item.last_contact %}
                    {{ item.last_contact|date:"M j" }}
                    <br><small style="color: var(--muted-color);">{{ item.last_contact|timesince }} {% trans "ago" %}</small>
                {% else %}
                    <span style="color: var(--muted-color);">{% trans "Never" %}</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</figure>

{% if page.has_other_pages %}
<nav class="pagination" aria-label="{% trans 'Pagination' %}">
    {% if page.has_previous %}
    <a href="?page={{ page.previous_page_number }}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if program_filter %}&program={{ program_filter }}{% endif %}"
       hx-get="{% url 'clients:client_list' %}?page={{ page.previous_page_number }}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if program_filter %}&program={{ program_filter }}{% endif %}"
       hx-target="#client-list-container"
       hx-indicator="#loading-bar"
       hx-push-url="true">{% trans "Previous" %}</a>
    {% endif %}
    {% blocktrans with current=page.number total=page.paginator.num_pages %}Page {{ current }} of {{ total }}{% endblocktrans %}
    {% if page.has_next %}
    <a href="?page={{ page.next_page_number }}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if program_filter %}&program={{ program_filter }}{% endif %}"
       hx-get="{% url 'clients:client_list' %}?page={{ page.next_page_number }}{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if program_filter %}&program={{ program_filter }}{% endif %}"
       hx-target="#client-list-container"
       hx-indicator="#loading-bar"
       hx-push-url="true">{% trans "Next" %}</a>
    {% endif %}
</nav>
{% endif %}

{% else %}
<div class="empty-state">
    {% if search_query %}
    <p>{% blocktrans with clients=term.client_plural|default:"participants" query=search_query %}No {{ clients }} found matching "{{ query }}". Try a different name or check the spelling.{% endblocktrans %}</p>
    <a href="{% url 'clients:client_list' %}" role="button">{% trans "Clear search" %}</a>
    {% elif status_filter or program_filter %}
    <p>{% blocktrans with clients=term.client_plural|default:"participants" %}No {{ clients }} match the selected filters.{% endblocktrans %}</p>
    <a href="{% url 'clients:client_list' %}" role="button">{% trans "Clear filters" %}</a>
    {% else %}
    <p>{% blocktrans with client=term.client|default:"participant" %}No {{ client }} files yet.{% endblocktrans %}</p>
    {% if can_create %}
    <a href="{% url 'clients:client_create' %}" role="button">{% trans "Create the first one" %}</a>
    {% endif %}
    {% endif %}
</div>
{% endif %}
