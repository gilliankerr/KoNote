{% extends "base.html" %}

{% block title %}{{ term.client_plural|default:"Clients" }} â€” {{ site.product_name|default:"KoNote" }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ term.client_plural|default:"Clients" }}</h1>
    <p>All {{ term.client|default:"client" }} files you have access to.</p>
</div>

<p><a href="{% url 'clients:client_create' %}" role="button">New {{ term.client|default:"Client" }}</a></p>

<!-- Filter bar -->
<details class="filter-bar" open>
    <summary>Filters</summary>
    <form id="client-filters" role="search">
        <div class="filter-row">
            <div class="filter-field">
                <label for="filter-status">Status</label>
                <select id="filter-status"
                        name="status"
                        hx-get="{% url 'clients:client_list' %}"
                        hx-target="#client-list-container"
                        hx-include="#client-filters"
                        hx-indicator="#loading-bar"
                        hx-push-url="true">
                    <option value="">All statuses</option>
                    <option value="active"{% if status_filter == "active" %} selected{% endif %}>Active</option>
                    <option value="inactive"{% if status_filter == "inactive" %} selected{% endif %}>Inactive</option>
                    <option value="discharged"{% if status_filter == "discharged" %} selected{% endif %}>Discharged</option>
                </select>
            </div>
            {% if features.programs and accessible_programs %}
            <div class="filter-field">
                <label for="filter-program">{{ term.program|default:"Program" }}</label>
                <select id="filter-program"
                        name="program"
                        hx-get="{% url 'clients:client_list' %}"
                        hx-target="#client-list-container"
                        hx-include="#client-filters"
                        hx-indicator="#loading-bar"
                        hx-push-url="true">
                    <option value="">All {{ term.program_plural|default:"programs" }}</option>
                    {% for prog in accessible_programs %}
                    <option value="{{ prog.pk }}"{% if program_filter == prog.pk|stringformat:"d" %} selected{% endif %}>{{ prog.name }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}
            <div class="filter-actions">
                <a href="{% url 'clients:client_list' %}" class="secondary" role="button">Clear filters</a>
            </div>
        </div>
    </form>
</details>

<!-- Client list container (updated via HTMX) -->
<div id="client-list-container" aria-live="polite">
    {% include "clients/_client_list_table.html" %}
</div>
{% endblock %}
