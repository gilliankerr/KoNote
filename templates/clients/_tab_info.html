<!-- Partial: Info tab content -->
<div class="action-bar">
    <a href="{% url 'clients:client_edit' client_id=client.pk %}" role="button" class="outline">Edit</a>
    <a href="{% url 'clients:client_list' %}" role="button" class="outline secondary">Back to List</a>
    <a href="{% url 'reports:client_progress_pdf' client_id=client.pk %}" role="button" class="outline secondary">Export PDF</a>
</div>

<section>
    <h2>Basic Information</h2>
    <dl class="info-grid">
        <dt>First Name</dt><dd>{{ client.first_name }}</dd>
        <dt>Last Name</dt><dd>{{ client.last_name }}</dd>
        {% if client.middle_name %}<dt>Middle Name</dt><dd>{{ client.middle_name }}</dd>{% endif %}
        {% if client.birth_date %}<dt>Date of Birth</dt><dd>{{ client.birth_date }}</dd>{% endif %}
        {% if client.record_id %}<dt>Record ID</dt><dd>{{ client.record_id }}</dd>{% endif %}
    </dl>

    {% if enrolments %}
    <h3>{{ term.program_plural|default:"Programs" }}</h3>
    <ul>
        {% for e in enrolments %}
        <li>
            <span class="program-dot" style="background-color: {{ e.program.colour_hex }}" aria-hidden="true"></span>
            {{ e.program.name }}
        </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if custom_data %}
    <hr>
    <h2>Additional Details</h2>
    <form method="post" action="{% url 'clients:client_save_custom_fields' client_id=client.pk %}">
        {% csrf_token %}
        {% for group in custom_data %}
        <fieldset>
            <legend>{{ group.group.title }}</legend>
            {% for item in group.fields %}
            <div class="form-row">
                <label for="custom_{{ item.field_def.pk }}">
                    {{ item.field_def.name }}
                    {% if item.field_def.is_required %}<abbr title="required">*</abbr>{% endif %}
                    {% if item.field_def.is_sensitive %}<small class="secondary">(encrypted)</small>{% endif %}
                </label>
                {% if item.field_def.input_type == "textarea" %}
                    <textarea name="custom_{{ item.field_def.pk }}" id="custom_{{ item.field_def.pk }}" rows="3" placeholder="{{ item.field_def.placeholder }}" {% if item.field_def.is_required %}required{% endif %}>{{ item.value }}</textarea>
                {% elif item.field_def.input_type == "select" %}
                    <select name="custom_{{ item.field_def.pk }}" id="custom_{{ item.field_def.pk }}" {% if item.field_def.is_required %}required{% endif %}>
                        <option value="">Selectâ€¦</option>
                        {% for opt in item.field_def.options_json %}
                        <option value="{{ opt }}" {% if item.value == opt %}selected{% endif %}>{{ opt }}</option>
                        {% endfor %}
                    </select>
                {% elif item.field_def.input_type == "date" %}
                    <input type="date" name="custom_{{ item.field_def.pk }}" id="custom_{{ item.field_def.pk }}" value="{{ item.value }}" {% if item.field_def.is_required %}required{% endif %}>
                {% elif item.field_def.input_type == "number" %}
                    <input type="number" name="custom_{{ item.field_def.pk }}" id="custom_{{ item.field_def.pk }}" value="{{ item.value }}" placeholder="{{ item.field_def.placeholder }}" {% if item.field_def.is_required %}required{% endif %}>
                {% else %}
                    <input type="text" name="custom_{{ item.field_def.pk }}" id="custom_{{ item.field_def.pk }}" value="{{ item.value }}" placeholder="{{ item.field_def.placeholder }}" {% if item.field_def.is_required %}required{% endif %}>
                {% endif %}
            </div>
            {% endfor %}
        </fieldset>
        {% endfor %}
        <button type="submit">Save Custom Fields</button>
    </form>
    {% endif %}
</section>
