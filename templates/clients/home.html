{% extends "base.html" %}

{% block title %}{{ term.client_plural|default:"Clients" }} — {{ site.product_name|default:"KoNote" }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ term.client_plural|default:"Clients" }}</h1>
    <p>Search and manage {{ term.client|default:"client" }} files.</p>
</div>

<!-- Quick actions -->
<div role="group">
    <a href="{% url 'clients:client_create' %}" role="button">New {{ term.client|default:"Client" }}</a>
    <a href="{% url 'clients:client_list' %}" role="button" class="outline">View All</a>
</div>

<!-- Search -->
<div role="search">
    <input type="search"
           name="q"
           placeholder="Search by name or ID..."
           autofocus
           aria-label="Search {{ term.client_plural|default:'clients' }}"
           hx-get="{% url 'clients:client_search' %}"
           hx-trigger="input changed delay:300ms"
           hx-target="#client-list"
           hx-indicator="#loading-bar">
</div>

<div id="client-list" aria-live="polite">
    {% include "clients/_search_results.html" %}
</div>

<!-- Dashboard -->
<div class="dashboard-grid">
    <!-- Quick stats -->
    <article class="stat-hero">
        <div class="card-header">Quick Stats</div>
        <div class="stat-number">{{ active_count }}</div>
        <div class="stat-label">Active {{ term.client_plural|default:"clients" }}</div>
        <div style="margin-top: var(--kn-space-md);">
            <span class="stat-secondary">{{ total_count }}</span>
            <span class="stat-label"> total</span>
        </div>
    </article>

    <!-- Active alerts -->
    <article{% if active_alerts %} class="card-alert"{% endif %}>
        <div class="card-header">Active Alerts</div>
        {% if active_alerts %}
        <ul class="card-list">
            {% for alert in active_alerts %}
            <li>
                <a href="{% url 'clients:client_detail' client_id=alert.client_file.pk %}">
                    {{ alert.client_file.first_name }} {{ alert.client_file.last_name }}
                </a>
                — {{ alert.content|truncatechars:60 }}
                <small class="secondary">({{ alert.created_at|date:"Y-m-d" }})</small>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="secondary"><em>No active alerts.</em></p>
        {% endif %}
    </article>
</div>

<div class="dashboard-grid">
    <!-- Recently viewed -->
    <article>
        <div class="card-header">Recently Viewed</div>
        {% if recent_clients %}
        <ul class="card-list">
            {% for item in recent_clients %}
            <li><a href="{% url 'clients:client_detail' client_id=item.client.pk %}">{{ item.name }}</a></li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="secondary"><em>No recent {{ term.client_plural|default:"clients" }} yet.</em></p>
        {% endif %}
    </article>

    <!-- Needs attention -->
    <article{% if needs_attention %} class="card-warning"{% endif %}>
        <div class="card-header">Needs Attention</div>
        <small class="secondary">{{ term.client_plural|default:"Clients" }} with no notes in the last 30 days</small>
        {% if needs_attention %}
        <ul class="card-list">
            {% for item in needs_attention %}
            <li><a href="{% url 'clients:client_detail' client_id=item.client.pk %}">{{ item.name }}</a></li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="secondary"><em>All {{ term.client_plural|default:"clients" }} are up to date.</em></p>
        {% endif %}
    </article>
</div>
{% endblock %}
