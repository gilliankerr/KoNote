{% extends "base.html" %}
{% load i18n %}

{% block title %}{% if editing %}{% trans "Edit Meeting" %}{% else %}{% trans "New Meeting" %}{% endif %} â€” {{ client.display_name }} {{ client.last_name }}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% if editing %}{% trans "Edit Meeting" %}{% else %}{% trans "New Meeting" %}{% endif %}</h1>
    <p>{{ client.display_name }} {{ client.last_name }}{% if client.record_id %} ({{ client.record_id }}){% endif %}</p>
</hgroup>

<form method="post" id="meeting-form">
    {% csrf_token %}

    <label for="{{ form.start_timestamp.id_for_label }}">
        {{ form.start_timestamp.label }}
    </label>
    <small id="meeting-start-required">{% trans "* Required field." %}</small>
    {{ form.start_timestamp }}
    <button type="button" id="open-datetime-picker" class="secondary outline">
        <span aria-hidden="true">ðŸ“…</span>
        {% trans "Open calendar and time picker" %}
    </button>
    <small id="meeting-start-help">{% trans "Required. Pick from the calendar or type the date and time." %}</small>
    {% if form.start_timestamp.errors %}
    <small class="badge badge-danger" role="alert">{{ form.start_timestamp.errors.0 }}</small>
    {% endif %}

    <label for="{{ form.location.id_for_label }}">
        {{ form.location.label }}
    </label>
    {{ form.location }}
    <datalist id="meeting-location-options">
        <option value="In person">
        <option value="Phone">
    </datalist>
    <small>{% trans "Choose In person or Phone, or type a custom location." %}</small>
    {% if form.location.errors %}
    <small class="badge badge-danger" role="alert">{{ form.location.errors.0 }}</small>
    {% endif %}

    {% if not editing %}
    {% if features.messaging_sms or features.messaging_email %}
    {% if can_send_reminders %}
    <fieldset>
        <label for="{{ form.send_reminder.id_for_label }}">
            {{ form.send_reminder }}
            {{ form.send_reminder.label }}
        </label>
    </fieldset>
    {% else %}
    <fieldset>
        <label class="secondary">
            <input type="checkbox" disabled>
            {% trans "Send reminder" %}
            <small>({% trans "Participant has not consented to reminders" %})</small>
        </label>
    </fieldset>
    {% endif %}
    {% endif %}
    {% endif %}

    {% if editing %}
    <label for="{{ form.duration_minutes.id_for_label }}">
        {{ form.duration_minutes.label }}
    </label>
    {{ form.duration_minutes }}
    {% if form.duration_minutes.errors %}
    <small class="badge badge-danger" role="alert">{{ form.duration_minutes.errors.0 }}</small>
    {% endif %}

    <label for="{{ form.status.id_for_label }}">
        {{ form.status.label }}
    </label>
    {{ form.status }}
    {% if form.status.errors %}
    <small class="badge badge-danger" role="alert">{{ form.status.errors.0 }}</small>
    {% endif %}
    {% endif %}

    <div role="group">
        <button type="submit">{% if editing %}{% trans "Save Changes" %}{% else %}{% trans "Create a Meeting" %}{% endif %}</button>
        <a href="{% url 'events:event_list' client_id=client.pk %}" role="button" class="outline">{% trans "Cancel" %}</a>
    </div>
</form>
{% endblock %}

{% block extra_scripts %}
{{ block.super }}
<script>
document.addEventListener("DOMContentLoaded", function () {
    var pickerButton = document.getElementById("open-datetime-picker");
    var dateTimeInput = document.getElementById("{{ form.start_timestamp.id_for_label }}");
    if (!pickerButton || !dateTimeInput) {
        return;
    }
    pickerButton.addEventListener("click", function () {
        if (typeof dateTimeInput.showPicker === "function") {
            dateTimeInput.showPicker();
            return;
        }
        dateTimeInput.focus();
        dateTimeInput.click();
    });
});
</script>
{% endblock %}
