{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Report Templates" %} — {{ site.product_name|default:"KoNote" }}{% endblock %}

{% block content %}
<hgroup>
    <h1>{% trans "Report Templates" %}</h1>
    <p>{% trans "Manage reporting templates for demographic and category breakdowns." %}</p>
</hgroup>

<div style="margin-bottom: 1.5rem; display: flex; gap: 0.5rem; align-items: center;">
    <a href="{% url 'admin_settings:report_template_upload' %}" role="button">{% trans "Upload New Template" %}</a>
    <a href="{% url 'admin_settings:report_template_sample_csv' %}" role="button" class="outline secondary">{% trans "Download Sample CSV" %}</a>
</div>

{% if profiles %}
<div class="overflow-auto">
    <table>
        <thead>
            <tr>
                <th>{% trans "Template Name" %}</th>
                <th>{% trans "Breakdowns" %}</th>
                <th>{% trans "Programs" %}</th>
                <th>{% trans "Created" %}</th>
                <th>{% trans "Actions" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for profile in profiles %}
            <tr>
                <td>
                    <a href="{% url 'admin_settings:report_template_detail' profile.pk %}">
                        <strong>{{ profile.name }}</strong>
                    </a>
                    {% if profile.description %}
                    <br><small class="secondary">{{ profile.description|truncatewords:12 }}</small>
                    {% endif %}
                </td>
                <td>{{ profile.breakdowns.count }}</td>
                <td>{{ profile.programs.count }}</td>
                <td>
                    <small>{{ profile.created_at|date:"Y-m-d" }}</small>
                    {% if profile.created_by %}
                    <br><small class="secondary">{{ profile.created_by.display_name }}</small>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'admin_settings:report_template_detail' profile.pk %}" class="secondary">{% trans "View" %}</a>
                    &nbsp;|&nbsp;
                    <a href="{% url 'admin_settings:report_template_edit_programs' profile.pk %}" class="secondary">{% trans "Programs" %}</a>
                    &nbsp;|&nbsp;
                    <a href="{% url 'admin_settings:report_template_delete' profile.pk %}" class="secondary" style="color: var(--pico-color-red-500);">{% trans "Delete" %}</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<article>
    <p>{% trans "No report templates configured yet. Upload a CSV to create your first template." %}</p>
    <p><small>{% trans "Tip: You can use a sample funder requirement to create your first reporting template." %}</small></p>
</article>
{% endif %}

<details style="margin-top: 2rem;">
    <summary>{% trans "About Report Templates" %}</summary>
    <p>{% trans "The \"Reporting template\" entry is demo sample data only and is not required for production use." %}</p>
    <p>{% blocktrans %}Report templates define how demographic data is broken down in reports. Different funders may define "youth" or "senior" differently, or require specific custom field groupings.{% endblocktrans %}</p>
    <p>{% blocktrans %}To create a template: prepare a CSV, upload it here, then assign programs so report forms can offer it as an option.{% endblocktrans %}</p>
</details>

<p><a href="{% url 'admin_settings:dashboard' %}">{% trans "← Back to Settings" %}</a></p>
{% endblock %}
