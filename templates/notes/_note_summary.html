{% load i18n %}
<!-- HTMX partial: collapsed card view of a single note -->
<div class="note-card-inner"
     hx-get="{% url 'notes:note_detail' note_id=note.pk %}"
     hx-target="#note-{{ note.pk }}"
     hx-swap="innerHTML"
     hx-indicator="#loading-bar"
     role="button"
     tabindex="0"
     aria-label="{% if note.note_type == 'quick' %}{{ term.quick_note|default:'Quick note' }}{% else %}{% trans 'Full note' %}{% endif %} â€” {{ note.effective_date|date:'M d, Y' }}">
    <div class="note-card-header">
        {% if note.note_type == "quick" %}
            <span class="badge badge-info">{{ term.quick_note|default:"Quick" }}</span>
        {% else %}
            <span class="badge badge-success">{% trans "Full" %}</span>
        {% endif %}
        {% if note.status == "cancelled" %}
            <span class="badge badge-danger">{% trans "Cancelled" %}</span>
        {% endif %}
        <span class="note-card-date">{{ note.effective_date|date:"M d, Y" }}</span>
        <span class="note-card-ago">{{ note.effective_date|timesince }} {% trans "ago" %}</span>
    </div>
    <div class="note-card-author">
        {% if note.author %}{{ note.author.display_name|default:note.author }}{% else %}{% trans "(unknown)" %}{% endif %}{% if note.author_program %} &middot; {{ note.author_program.name }}{% endif %}
    </div>
    {% if note.status == "cancelled" %}
        <p class="note-card-preview"><del>{{ note.notes_text|truncatechars:200 }}</del></p>
        {% if note.status_reason %}<p class="note-card-reason">{% trans "Reason:" %} {{ note.status_reason }}</p>{% endif %}
    {% else %}
        {% if note.notes_text %}
            <p class="note-card-preview">{{ note.notes_text|truncatechars:200 }}</p>
        {% endif %}
    {% endif %}
    <div class="note-card-meta">
        {% if note.target_count %}
            <span class="note-chip">{% blocktrans count target_count=note.target_count %}{{ target_count }} target{% plural %}{{ target_count }} targets{% endblocktrans %}</span>
        {% endif %}
        {% if note.template %}
            <span class="note-chip">{{ note.template.name }}</span>
        {% endif %}
        {% if note.follow_up_date %}
            <span class="note-chip note-chip--followup{% if note.follow_up_completed_at %} note-chip--done{% endif %}">
                {% if note.follow_up_completed_at %}&#10003; {% endif %}{% trans "Follow-up" %} {{ note.follow_up_date|date:"M d" }}
            </span>
        {% endif %}
    </div>
</div>
