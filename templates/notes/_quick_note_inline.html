{% load i18n %}
{# HTMX inline form for logging contacts as quick notes on the Timeline tab #}
<div id="quick-note-container" class="quick-log-section">
    <h2>{% trans "Log Contact" %}</h2>

    <form hx-post="{% url 'notes:quick_note_inline' client_id=client.pk %}"
          hx-target="#quick-note-container"
          hx-swap="outerHTML"
          id="inline-quick-note-form">
        {% csrf_token %}

        {% if form.non_field_errors %}
        <div class="error-summary" role="alert">
            {% for error in form.non_field_errors %}
            <p>{{ error }}</p>
            {% endfor %}
        </div>
        {% endif %}

        {# Interaction type radio pills #}
        <fieldset class="interaction-pills">
            <legend>{% trans "Type" %}</legend>
            {% for radio in form.interaction_type %}
            {{ radio }}
            {% endfor %}
            {% if form.interaction_type.errors %}
            <div role="alert"><small class="error">{{ form.interaction_type.errors.0 }}</small></div>
            {% endif %}
        </fieldset>

        {# Outcome — shown for phone/sms/email via progressive disclosure #}
        <div id="inline-outcome-group" {% if not form.outcome.value %}hidden{% endif %}>
            <label for="{{ form.outcome.id_for_label }}">{% trans "Outcome" %}</label>
            {{ form.outcome }}
            {% if form.outcome.errors %}
            <div role="alert"><small class="error">{{ form.outcome.errors.0 }}</small></div>
            {% endif %}
        </div>

        {# Notes #}
        <label for="{{ form.notes_text.id_for_label }}">{% trans "Notes" %}</label>
        {{ form.notes_text }}
        {% if form.notes_text.errors %}
        <div role="alert"><small class="error">{{ form.notes_text.errors.0 }}</small></div>
        {% endif %}

        {# Follow-up date #}
        <label for="{{ form.follow_up_date.id_for_label }}">{% trans "Follow up by" %} <small class="secondary">{% trans "(optional)" %}</small></label>
        {{ form.follow_up_date }}

        {# Consent — shown for session/home_visit and for reached contacts #}
        <div id="inline-consent-group" hidden>
            <label>
                {{ form.consent_confirmed }}
                {% trans "We created this note together" %}
            </label>
        </div>

        <div class="grid" style="margin-top: 0.5rem;">
            <button type="submit">{% trans "Save" %}</button>
            <button type="button" class="outline secondary"
                    hx-get="{% url 'notes:quick_note_inline' client_id=client.pk %}?mode=buttons"
                    hx-target="#quick-note-container"
                    hx-swap="outerHTML">
                {% trans "Cancel" %}
            </button>
        </div>
    </form>
</div>
